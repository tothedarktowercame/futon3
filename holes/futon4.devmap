@multiarg futon4/devmap
@title FUTON4 Development Map ‚Äî Memory Atelier & Hypertext Editing
@audience futon-devs, pattern-agents, future-you
@tone formal-analytic
@style roadmap
@factor Tranquility (passaddhi)
@IFR: FUTON4 is a memory workspace where documents, design patterns, and
annotations share a common editing environment, letting symbolic artefacts be
edited, linked, and narrated in one continuous workspace.
@state Arxana reanimation complete (storage bridge, browsing, relations, 80+
tests). Scholium mode has inclusion/transclusion previews with toggle commands.
Pattern template support operational. Gaps: graph storage layer not wired to
Datascript; XTDB integration pending; multi-user and literary interfaces planned.
@next Complete scholium UX for main article buffer; wire storage layer to
Datascript; begin XTDB integration for version history.

## The Argument

FUTON4 is a memory workspace where documents, design patterns, and annotations
share a common editing environment. A key use case is to align software
documentation and code, and for this reason an early prototype makes the system
self-documenting. Arxana is a hypertext editor that links document fragments
and lets you annotate them with scholia. Scholium mode shows how content is
included or transcluded from other documents, with visual previews. Design
patterns in a standard template are supported, translating into graph nodes for
both human and machine editing. Futon4 stores text fragments and hyperlinks as
addressable nodes so they can be queried and linked. XTDB adds version history
so you can see how documents evolved over time. Multi-user support lets
collaborators share a semantic space. A literary interface supports long-form
writing like books and manuscripts.


! instantiated-by: Prototype 0 ‚Äî Self-Documenting Foundations [üåΩ/‰πÖ üôÖ/Êâç]
  :maturity :settled
  :depends-on []
  :evidence-for-settled [Tangling machinery operational; bootstrap harness tested; manifesto documented]

  + context: A key use case for futon4 is to align software documentation and code.
  + IF: You want documentation and implementation to stay synchronized
  + HOWEVER: Without self-documenting infrastructure, docs and code drift apart
  + THEN: Make the system self-documenting with tangling machinery, bootstrap harness, and development manifesto
  + BECAUSE: This creates an anchor for all subsequent prototypes

  + EVIDENCE:
    evidence[spine.org provides master orchestration with tangling machinery (lines 19-103)]
    evidence[dev/bootstrap.el is repeatable build harness for interactive + batch builds]
    evidence[AGENTS.md is development manifesto describing Phase 1/2 strategy]
    evidence[docs/reanimation-plan.org tracks M0-M6 milestones with checkbox progress]
    evidence[test/arxana-bootstrap-test.el validates baseline harness (3 tests)]
    evidence[arxana-tangled.el is generated single-source output (3752 lines) proving round-trip]

  + NEXT-STEPS:
    next[Maintain synchronization as system evolves]

  :success-criteria
    pass[Tangling produces consistent output]
    pass[Bootstrap harness runs without errors]
    pass[Documentation reflects current implementation]
    fail[Docs and code diverge silently]

  :psr-example "Selected self-documenting foundations because aligned docs reduce maintenance burden"
  :pur-template "Tangle run, output: {{file}}, lines: {{count}}, errors: {{errors}}"


! instantiated-by: Prototype 1 ‚Äî Arxana Hypertext Editor [üôÖ/‰πÖ üíñ/Áî®]
  :maturity :settled
  :depends-on [f4/P0]
  :evidence-for-settled [Spine parser rebooted; node browsing restored; storage bridge complete; 80+ tests pass]

  + context: Arxana is a hypertext editor that links document fragments and annotations.
  + IF: You want stable parsing, node navigation, and save-back working
  + HOWEVER: Legacy structures were dormant and needed reanimation
  + THEN: Reboot spine parser, restore node browsing, define nema-based schema, implement storage bridge, test round-trip edits
  + BECAUSE: A functioning editor is the precondition for all downstream memory work

  + EVIDENCE:
    evidence[spine.org lines 50-103 define arxana-tangle-spine-concat]
    evidence[dev/arxana-relations.el provides ego, cooccur, tail commands]
    evidence[dev/arxana-browse.el provides catalog, labels, history navigation]
    evidence[0-Reintroduction.org documents EAV model (nema, article, metadata scholium, event/hyperedge, plexus)]
    evidence[15 test files in test/ with ~80 tests total]
    evidence[dev/arxana-store.el (350+ lines) with 12 Futon API helpers]
    evidence[docs/storage-bridge.org documents API with curl examples]
    evidence[dev/arxana-article.el handles metadata sync and deletion propagation]
    evidence[dev/arxana-scholium.el provides compose, region capture, authoring mode]

  + NEXT-STEPS:
    next[Produce migration notes for historical datasets (M5 item)]
    next[Add CI configuration for automated testing]
    next[Tag "revived" release with reproducible steps]

  :success-criteria
    pass[Spine parser produces correct output]
    pass[Node browsing navigates document graph]
    pass[Storage bridge syncs with futon1]
    pass[Round-trip edits preserve content]
    fail[Edits corrupt document structure]

  :psr-example "Selected Arxana reboot for hypertext editing because linked documents need stable infrastructure"
  :pur-template "Arxana session, nodes visited: {{count}}, edits: {{edits}}, saved: {{yes|no}}"


! instantiated-by: Prototype 2 ‚Äî Scholium Mode [üê≤/‰πÖ üôÖ/Áî®]
  :maturity :active
  :depends-on [f4/P1]
  :evidence-for-active [Derivation previews working; toggle commands implemented; 5 tests pass]

  + context: Scholium mode shows how content is included or transcluded from other documents.
  + IF: You want to see document relationships with visual affordances
  + HOWEVER: Inclusion/transclusion relationships were not visually differentiated
  + THEN: Add collapsible previews, color overlays, and toggle commands for inclusion/transclusion/identification highlights
  + BECAUSE: Visual affordances make document structure navigable

  + EVIDENCE:
    evidence[dev/arxana-derivation.el (290+ lines) provides preview blocks and face definitions]
    evidence[arxana-derivation-toggle-inclusion-highlights command implemented]
    evidence[arxana-derivation-toggle-transclusion-highlights command implemented]
    evidence[arxana-derivation-toggle-identification-highlights command implemented]
    evidence[test/arxana-derivation-test.el covers preview detection, rendering, toggle (5 tests)]

  + NEXT-STEPS:
    next[Wire main article buffer overlays to mark-things-up hook]
    next[Document visual affordances in docs/inclusion-ui.md]
    next[Add integration test for main buffer + display buffer side-by-side]

  :success-criteria
    pass[Previews render correctly in display buffer]
    pass[Toggle commands differentiate derivative types]
    pass[Main article buffer shows overlays]
    fail[Inclusion/transclusion indistinguishable]

  :psr-example "Selected scholium mode for document relationships because visual previews aid navigation"
  :pur-template "Scholium view, inclusions: {{inc}}, transclusions: {{trans}}, identifications: {{id}}"


! instantiated-by: Prototype 3 ‚Äî Design Pattern Templates [üôÖ/Âèå üí¨/Âç°]
  :maturity :active
  :depends-on [f4/P1]
  :evidence-for-active [Flexiarg format operational; pattern templates translate to graph nodes]

  + context: Design patterns in a standard template need to be editable as both text and graph.
  + IF: You want patterns to be human-readable and machine-structured
  + HOWEVER: Without a translation layer, patterns stay as flat text
  + THEN: Define schema mapping argument blocks (IF/HOWEVER/THEN/BECAUSE) to graph nodes; support bidirectional editing
  + BECAUSE: Bidirectional editing lets humans and machines work on the same artefacts

  + EVIDENCE:
    evidence[Flexiarg format documented and in use across devmaps]
    evidence[Pattern templates parseable as structured blocks]

  + NEXT-STEPS:
    next[Implement graph node generation from flexiarg blocks]
    next[Add bidirectional sync (graph changes reflect in text)]
    next[Test round-trip editing of pattern templates]

  :success-criteria
    pass[Flexiarg blocks translate to graph nodes]
    pass[Graph edits reflect back in text]
    pass[Pattern metadata preserved in translation]
    fail[Translation loses structure or content]

  :psr-example "Selected pattern templates for bidirectional editing because patterns serve humans and machines"
  :pur-template "Pattern translate {{id}}, nodes: {{count}}, round-trip: {{pass|fail}}"


! instantiated-by: Prototype 4 ‚Äî Graph Storage Layer [üôÖ/‰πÖ üëÄ/‰πÉ]
  :maturity :greenfield
  :depends-on [f4/P1]
  :evidence-for-active [Storage wired to Datascript; nodes addressable and queryable]

  + context: Futon4 stores text fragments and hyperlinks as addressable nodes.
  + IF: You want fragments to be queryable and linkable
  + HOWEVER: No memory manager wires Arxana buffers to Datascript
  + THEN: Implement add-node, activate-node, link-node; persist via Datascript; replay sessions to prove round-trips
  + BECAUSE: Without a living graph memory, Arxana cannot escape editor mode

  + EVIDENCE:
    evidence[Arxana store talks to futon1 API]
    evidence[Basic node operations exist]

  + NEXT-STEPS:
    next[Wire Arxana buffers to Datascript]
    next[Implement add-node, activate-node, link-node]
    next[Test session replay for round-trip verification]

  :success-criteria
    pass[Nodes stored in Datascript]
    pass[Nodes queryable by ID and content]
    pass[Session replay reconstructs state]
    fail[Node operations not persisted]

  :psr-example "Selected graph storage for queryable fragments because addressable nodes enable linking"
  :pur-template "Node operation {{op}}, node: {{id}}, persisted: {{yes|no}}"


! instantiated-by: Prototype 5 ‚Äî XTDB Version History [‚åõÔ∏è/‰πÖ üôÖ/ÂàÜ]
  :maturity :greenfield
  :depends-on [f4/P4]
  :evidence-for-active [XTDB integrated; time-travel queries working; branching histories supported]

  + context: XTDB adds version history so you can see how documents evolved.
  + IF: You want durability, branching histories, and provenance queries
  + HOWEVER: XTDB idioms differ from Datascript and require schema migration
  + THEN: Rekey schema for XTDB, add transaction logs, implement time-travel queries
  + BECAUSE: Version history turns Arxana into a serious memory engine

  + EVIDENCE:
    evidence[XTDB available in futon1 stack]
    evidence[Schema migration patterns documented]

  + NEXT-STEPS:
    next[Design XTDB schema for Arxana nodes]
    next[Implement transaction logging]
    next[Add time-travel query interface]
    next[Test branching and merge scenarios]

  :success-criteria
    pass[Documents have version history]
    pass[Time-travel queries return past states]
    pass[Branching histories supported]
    fail[History lost on edit]

  :psr-example "Selected XTDB for version history because document evolution needs to be traceable"
  :pur-template "Time-travel query, node: {{id}}, timestamp: {{ts}}, found: {{yes|no}}"


! instantiated-by: Prototype 6 ‚Äî Multi-User Support [üî¶/Èó® üôÖ/‰∫í]
  :maturity :greenfield
  :depends-on [f4/P5]
  :evidence-for-active [Multi-user sync operational; collaborators share semantic space]

  + context: Multi-user support lets collaborators share a semantic space.
  + IF: You want multiple people to work in the same document graph
  + HOWEVER: No multi-user or sync layer exists yet
  + THEN: Use Datascript local + XTDB remote as stepping stones; implement sync protocol
  + BECAUSE: Shared memory opens the door to collaborative reasoning

  + EVIDENCE:
    evidence[XTDB provides remote persistence foundation]
    evidence[Datascript provides local cache]

  + NEXT-STEPS:
    next[Design sync protocol between local and remote]
    next[Implement conflict resolution]
    next[Test multi-user editing scenarios]
    next[Add presence indicators]

  :success-criteria
    pass[Multiple users see consistent state]
    pass[Edits propagate to all users]
    pass[Conflicts resolved gracefully]
    fail[Users see divergent states]

  :psr-example "Selected multi-user support for collaboration because shared memory enables co-reasoning"
  :pur-template "Sync event, users: {{count}}, conflicts: {{conflicts}}, resolved: {{yes|no}}"


! instantiated-by: Prototype 7 ‚Äî Literary Interface [üôÖ/‰πü üíñ/‰πÖ]
  :maturity :greenfield
  :depends-on [f4/P2]
  :evidence-for-active [Manuscript mode operational; chunking and cross-reference working]

  + context: A literary interface supports long-form writing like books and manuscripts.
  + IF: You want to edit books or long-form text via Arxana
  + HOWEVER: No good UI for long-form text exists yet
  + THEN: Add manuscript mode with chunking and cross-reference map
  + BECAUSE: FUTON becomes a writing environment, not just an editor

  + EVIDENCE:
    evidence[Arxana handles document fragments]
    evidence[Scholium mode provides linking infrastructure]

  + NEXT-STEPS:
    next[Design manuscript mode UI]
    next[Implement chapter/section chunking]
    next[Add cross-reference map visualization]
    next[Test with real manuscript content]

  :success-criteria
    pass[Long documents chunked into navigable sections]
    pass[Cross-references visualized and navigable]
    pass[Manuscript mode supports book-length content]
    fail[Long documents unwieldy to edit]

  :psr-example "Selected literary interface for book editing because long-form writing needs specialized support"
  :pur-template "Manuscript session, chapters: {{count}}, cross-refs: {{refs}}, words: {{words}}"
